trigger:
- none

pool:
  name: Agentpool    
  demands:
    - agent.name -equals agentjdid

steps:

- script: |
    export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
    chmod +x ./gradlew
  displayName: 'Set JAVA_HOME and Grant execute permissions to Gradle wrapper'

- task: Gradle@3
  inputs:
    wrapperScript: 'gradlew'
    tasks: 'build'
    options: '-x test'
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: '1.8'
    workingDirectory: ''
    gradleOptions: ''
    sonarQubeRunAnalysis: false
  displayName: 'Build the Android project'

- task: Gradle@3
  inputs:
    wrapperScript: 'gradlew'
    tasks: 'test'
    javaHomeOption: 'JDKVersion'
    jdkVersionOption: '1.8'
    workingDirectory: ''
    gradleOptions: ''
    sonarQubeRunAnalysis: false
  displayName: 'Run unit tests'

- task: CopyFiles@2
  inputs:
    contents: '**/*.apk'
    targetFolder: '$(build.artifactStagingDirectory)'

- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: '$(build.artifactStagingDirectory)'
    artifactName: 'drop'
